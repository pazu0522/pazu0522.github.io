---
title:  "확률론 기초(Stats 110) : Lesson 32. Markov Chain (2)"
excerpt: "하버드 대학교 조셉 K. 블리츠타인 교수의 Stats 110 32강 정리"

categories:
  - 통계학
  - 확률론
tags:
  - 마르코프 체인
use_math: true
comments: true
last_modified_at: 2021-06-21T23:30:00
header:
  image: /assets/images/texture.jpg
---

<img src="/assets/images/stats_110/lesson_32.jpg" width="80%" height="80%" title="chain" alt="chain"/> 

# 1. 마르코프 체인

- [**종류와 성질**](https://pazu0522.github.io/%ED%86%B5%EA%B3%84%ED%95%99/%ED%99%95%EB%A5%A0%EB%A1%A0/stats110_32/#%EC%A2%85%EB%A5%98%EC%99%80-%EC%84%B1%EC%A7%88)
- [**기약적 마르코프 체인**](https://pazu0522.github.io/%ED%86%B5%EA%B3%84%ED%95%99/%ED%99%95%EB%A5%A0%EB%A1%A0/stats110_32/#%EA%B8%B0%EC%95%BD%EC%A0%81-%EB%A7%88%EB%A5%B4%EC%BD%94%ED%94%84-%EC%B2%B4%EC%9D%B8)
- [**가역적 마르코프 체인**](https://pazu0522.github.io/%ED%86%B5%EA%B3%84%ED%95%99/%ED%99%95%EB%A5%A0%EB%A1%A0/stats110_32/#%EA%B0%80%EC%97%AD%EC%A0%81-%EB%A7%88%EB%A5%B4%EC%BD%94%ED%94%84-%EC%B2%B4%EC%9D%B8)


## 종류와 성질

<img src="/assets/images/stats_110/lesson_32_1.jpg" width="70%" height="70%" title="example1" alt="example1"/>

마르코프 체인이 **기약적**이라는 것은 체인 내의 어떤 상태에서 다른 어떤 상태로 반드시 이동할 수 있음을 의미한다. 따라서 위 그림에서 두 번째와 세 번째 마르코프 체인은 기약적이지 않다. 두 번째 마르코프 체인은 상태 $3$에서 상태 $6$으로 이어지는 점선이 없다면 상태 $1, 2, 3$에서 상태 $4, 5, 6$으로 또는 그 반대 방향으로 이동하는 것이 불가능하다. 세 번째 마르코프 체인은 상태 $1$에서 시작하는 경우 영원히 상태 $1$에서만 머물러야 하기 때문에 다른 상태로 이동이 불가능하다. 반면, 첫 번째와 네 번째 마르코프 체인은 유한한 단계를 거치면 어떠한 상태로든 이동이 가능하기 때문에 **기약적**이다.

마르코프 체인이 **재귀적**이라는 것은 체인 내의 어떤 상태에서 출발하여 언젠가는 다시 그 상태로 되돌아 올 확률이 항상 $1$이라는 것을 의미한다. 재귀적이지 않은 마르코프 체인은 **일시적**이라 한다. 따라서 위 그림에서 첫 번째와 네 번째 마르코프 체인은 재귀적이다. 두 번째 마르코프 체인은 점선이 존재한다면 상태 $1, 2, 3$은 일시적이고 상태 $4, 5, 6$은 재귀적이다. 상태 $3$에서 상태 $6$으로 한 번 이동하면 다시는 상태 $1, 2, 3$으로 되돌아 갈 수 없기 때문이다. 세 번째 마르코프 체인은 상태 $1, 4$는 재귀적인 반면 상태 $2, 3$은 일시적이다. 상태 $2, 3$에서 상태 $1, 4$로 한 번 빠지는 순간 영원히 상태 $1, 4$에서 머물게 되기 때문이다. 이와 같은 상태를 **흡수 상태**라 한다. 세 번째 마르코프 체인은 [도박꾼의 파산](https://pazu0522.github.io/%ED%86%B5%EA%B3%84%ED%95%99/%ED%99%95%EB%A5%A0%EB%A1%A0/stats110_07/#%EB%8F%84%EB%B0%95%EA%BE%BC%EC%9D%98-%ED%8C%8C%EC%82%B0) 문제를 시각화한 것과 같다. 즉, 상태 $1, 4$로 언젠가는 빠지게 되어 본인이 파산하거나 상대방이 파산하는 것으로 귀결된다.

한편, 네 번째 마르코프 체인은 **주기적**이다. 체인의 주기성에 의해 $n$시간 후의 상태를 완벽하게 예측할 수 있다.


## 기약적 마르코프 체인

임의의 **기약적**이고 상태의 개수가 **유한**한 마르코프 체인에 대하여 정상 확률분포를 따르는 **유일**한 확률벡터 $\overset{\rightarrow} s = (s_{1}, s_{2}, \cdots, s_{m})$가 항상 존재한다. 이 때 $\overset{\rightarrow} s = (s_{1}, s_{2}, \cdots, s_{m})$에 대하여 $s_{i} = \frac{1}{r_{i}}$를 만족하는 $r_{i}$가 존재한다.

$r_{i}$는 상태 $i$에서 출발하여 다시 상태 $i$로 돌아오는 데 걸리는 **평균 시간** 또는 **단계** 즉, **기댓값**을 의미한다. 한편, $s_{i}$는 장시간의 진행 과정 중 상태 $i$에 머무르는 시간의 비율이라고 할 수 있다.

따라서 만약 전체 시간의 $\frac{1}{10}$ 시간만큼 상태 $i$에서 머무른다면 상태 $i$에서 출발하여 다시 상태 $i$로 돌아오기까지 평균적으로 $10$개 단계를 거쳐야 한다고 해석할 수 있다. 왜냐 하면, $10$번의 이동 중 한 번은 상태 $i$에 머물러야 전체 시간의 $\frac{1}{10}$ 시간만큼 상태 $i$에서 머무를 수 있기 때문이다.

또한, **기약적**이고 상태의 개수가 **유한**한 마르코프 체인에서 어떤 양의 정수 $m$에 대하여 행렬 $Q^{m}$의 모든 성분이 **양수**가 된다면 해당 마르코프 체인은 **주기적이지 않다**. 마르코프 체인이 주기적이지 않다면 $n \rightarrow \infty$에 따라 $P(X_{n}=i) \rightarrow s_{i}$가 성립한다. 이와 동치로, $\overset{\rightarrow} t$가 임의의 분포를 따르는 확률벡터일 때, $n \rightarrow \infty$에 따라 $\overset{\rightarrow} t Q^{m} \rightarrow \overset{\rightarrow} s $가 성립한다.

다시 말해 마르코프 체인 내에서 현재 상태(시작 단계 혹은 중간 단계)에 관계 없이 장시간의 과정을 거치면 $P(X_{n}=i)$에 대한 확률벡터의 분포가 **정상 확률분포**로 수렴한다.


## 가역적 마르코프 체인

전이 행렬 $Q = (q_{ij})$를 가지는 마르코프 체인이 존재할 때 만약 모든 $i,j$에 대하여 $s_{i} \cdot q_{ij} = s_{j} \cdot q_{ji}$가 성립하면 해당 마르코프 체인은 **가역적**이다. 또한, 어떤 확률벡터 $\overset{\rightarrow} s$가 위 조건을 만족시키는 경우, $\overset{\rightarrow} s$는 **정상 확률분포**를 따른다.

위 성질이 성립한다면 모든 $i$에 대하여 $s_{i} \cdot q_{ij} = s_{j} \cdot q_{ji}$가 성립하므로 $\sum_{i} s_{i} \cdot q_{ij} = \sum_{i} s_{j} \cdot q_{ji}$ 역시 성립한다. 그런데 $\sum_{i} s_{j} \cdot q_{ji} = s_{j} \cdot \sum_{i} q_{ji} = s_{j}$가 성립한다. 왜냐 하면, $\sum_{i} q_{ji}$는 전이 행렬에서 한 행의 모든 성분 합과 같으므로 값이 $1$이기 때문이다. 결과적으로 $s_{i} \cdot q_{ij} = s_{j}$이다.

$s_{i} \cdot q_{ij} = s_{j}$가 모든 $j$에 대하여 성립하기 때문에 벡터와 행렬 간 곱셈 정의에 의해 $\overset{\rightarrow} sQ = \overset{\rightarrow} s$가 성립한다. 따라서 마르코프 체인이 **가역적**이라면 반드시 **정상 확률분포**가 존재한다.

<img src="/assets/images/stats_110/lesson_32_2.jpg" width="40%" height="40%" title="example2" alt="example2"/>

예를 들어, 위와 같은 **무방향 네트워크**가 존재한다고 가정한다. $d_{i}$를 $i$의 차수 즉, 상태 $i$에서 **임의 보행**(Random Walk)을 통해 이동할 수 있는 다른 상태의 개수로 정의하면 $d_{1} = 2, \; d_{2} = 2, \; d_{3} = 2, \; d_{4} = 1$이다. 이 때 모든 $i,j$에 대하여 $d_{i} \cdot q_{ij} = d_{j} \cdot q_{ji}$가 성립한다.

$i=j$인 경우에는 자명하게 성립한다. $i \neq j$일 때, $A$에서 $B$로의 이동이 가능하면 그 반대 방향으로 이동도 가능한 무방향 네트워크의 성질에 의해 $q_{ij}$와 $q_{ji}$가 동시에 $0$의 값을 가지거나 동시에 $0$이 아닌 값을 가지게 된다. 따라서 $q_{ij} = 0$이면 반드시 $q_{ji} = 0$이다. 한편, 동시에 $0$이 아닌 값을 가지는 경우 $q_{ij} = \frac{1}{d_{i}}$이고 $q_{ji} = \frac{1}{d_{j}}$이므로 $d_{i} \cdot q_{ij} = d_{j} \cdot q_{ji} = 1$이 된다.

가역적 마르코프 체인의 성질에 따라 $\overset{\rightarrow} d$가 정상 확률분포를 따르는 것처럼 보일 수 있지만, $\overset{\rightarrow} d$의 벡터 성분 합은 $1$이 아니다. 따라서 벡터의 각 성분을 $\sum_{i}d_{i}$로 나누어서 합을 $1$로 만드는 **표준화** 과정이 필요하다. 표준화 과정을 거친 확률벡터 $\overset{\rightarrow} s = \frac{1}{\sum_{i}d_{i}} \overset{\rightarrow} d$는 정상 확률분포를 따른다.